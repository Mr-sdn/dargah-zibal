# dargah-zibal

**اتصال به درگاه پرداخت زیبال آسان و راحت**

**ویژگي ها**
- ایجاد سفارش 
- ایجاد لینک پرداخت
- تایید پرداخت
- استعلام پرداخت با کد تراکنش
- ایجاد سفارش با آپشن های مختلف

**نحوه استفاده**
- ساخت درگاه از سایت زیبال و گرفتن کد (merchant) مخصوص خود
- نصب پکیج بر روی سیستم

```
git clone https://github.com/Mr-sdn/dargah-zibal.git
```
- نصب پیش نیاز ها

```
pip install -r requirements.txt
```



**نکات مهم در استفاده از کد ها**

- حتما کد merchant را به عنوان آرگومان برای کلاس zibal بفرستید در غیر این صورت از کد پیش فرض زیبال استفاده خواهد شد که فقط برای تست قابلیت ها است و پرداختی صورت نخواهد گرفت
```
from dargah.dargah import Zibal
portal = Zibal("your-merchant")
```

- منظور از callbackUrl ادرس مورد نظر برای دریافت وضعیت ها توسط شماست و هر گونه تغییر در وضعیت پرداخت به این آدرس ارسال خواهد شد.
  
**مثال زمانی که پرداختی را ایجاد میکنید مانند زیر**

```
from dargah.dargah import Zibal
portal = Zibal()
trackId = portal.create_payment(4500, "https://yourcallbackurl")
link = portal.start_payment(trackId)
```
و لینک پرداخت را برای کاربر ارسال میکنید و پرداخت توسط کاربر انجام میشود وضعیت موفقیت آمیز بودن یا نبودن پرداخت به callbackurl شما ارسال خواهد شد
این اطلاعات به صورت Query String و از طریق متد GET برای callbackUrl ارسال می‌شوند.


بدنه Callback
| پارامتر  | توضیحات                                                                 |
|----------|--------------------------------------------------------------------------|
| success  | در صورت موفقیت‌آمیز بودن تراکنش ١، در غیر این‌صورت ٠ می‌باشد.            |
| trackId  | شناسه پیگیری جلسه‌ی پرداخت                                                |
| orderId  | شناسه سفارش ارسال شده در هنگام درخواست پرداخت (در صورت ارسال)           |
| status   | وضعیت پرداخت (از طریق [جدول وضعیت‌ها](#) می‌توانید مقادیر status را مشاهده نمایید) |


**مثال**
- https://yourcallbackurl.com/callback?trackId=9900&success=1&status=2&orderId=1
  
- زمانی که از موفقیت امیز بودن پرداخت مطمعن شدید میتوانید با متود زیر پرداخت را تایید نهایی کنید و سفارش را ببندید
  
```
portal.verify_payment(trackId)
```
